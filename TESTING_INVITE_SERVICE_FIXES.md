# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π Invite Service

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:

### 1. ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `get_current_user_id()` –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ –∑–∞–≥–ª—É—à–∫—É `return 1`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–¥–∏–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–∑ `app.core.auth`

### 2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Parsing Service  
**–ü—Ä–æ–±–ª–µ–º–∞**: –í–æ–∑–≤—Ä–∞—â–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –∑–∞–≥–ª—É—à–∫–∏ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ HTTP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### 3. ‚úÖ –ò–º–ø–æ—Ä—Ç –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞
**–ü—Ä–æ–±–ª–µ–º–∞**: Endpoint `/import/parsing` –≤–æ–∑–≤—Ä–∞—â–∞–ª –∑–∞–≥–ª—É—à–∫—É "not implemented"
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç InviteTarget

### 4. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: `task.target_count` —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –≤–º–µ—Å—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –°—á–µ—Ç—á–∏–∫ —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ —Ç–µ–∫—É—â–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é

### 5. ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤–æ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
curl -H "Authorization: Bearer <REAL_JWT_TOKEN>" \
  http://92.113.146.148:8000/api/v1/invite/parsing-tasks/

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 401 –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
curl -H "Authorization: Bearer invalid_token" \
  http://92.113.146.148:8000/api/v1/invite/parsing-tasks/
```

### –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -H "Authorization: Bearer <VALID_JWT>" \
  http://92.113.146.148:8000/api/v1/invite/parsing-tasks/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞—á–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# –ï—Å–ª–∏ parsing-service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è fallback
```

### –¢–µ—Å—Ç 3: –ò–º–ø–æ—Ä—Ç –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞
```bash
# –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É –∏–Ω–≤–∞–π—Ç–∏–Ω–≥–∞
curl -X POST -H "Authorization: Bearer <VALID_JWT>" \
  -H "Content-Type: application/json" \
  -d '{"name": "Test Task", "platform": "telegram", "priority": 2}' \
  http://92.113.146.148:8000/api/v1/invite/tasks/

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∞—É–¥–∏—Ç–æ—Ä–∏—é –∏–∑ –ø–∞—Ä—Å–∏–Ω–≥–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ task_id –∏ parsing_task_id)
curl -X POST -H "Authorization: Bearer <VALID_JWT>" \
  http://92.113.146.148:8000/api/v1/invite/import/tasks/1/import/parsing?parsing_task_id=parse_001&limit=100
```

### –¢–µ—Å—Ç 4: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å –∞—É–¥–∏—Ç–æ—Ä–∏–µ–π
```bash
# –°–æ–∑–¥–∞–π—Ç–µ CSV —Ñ–∞–π–ª —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
echo "username,phone,name
@test_user1,+1234567890,Test User 1
@test_user2,+0987654321,Test User 2" > test_audience.csv

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª
curl -X POST -H "Authorization: Bearer <VALID_JWT>" \
  -F "file=@test_audience.csv" \
  -F "source_name=test_upload" \
  http://92.113.146.148:8000/api/v1/invite/import/tasks/1/import/file
```

### –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—á–µ—Ç—á–∏–∫–∞ —Ü–µ–ª–µ–π
```bash
# –ü–æ–ª—É—á–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–¥–∞—á–µ
curl -H "Authorization: Bearer <VALID_JWT>" \
  http://92.113.146.148:8000/api/v1/invite/tasks/1

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ target_count —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ü–µ–ª–µ–π

# –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:
curl -H "Authorization: Bearer <VALID_JWT>" \
  http://92.113.146.148:8000/api/v1/invite/execution/1/diagnose
```

### –¢–µ—Å—Ç 6: –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏ –∏–Ω–≤–∞–π—Ç–∏–Ω–≥–∞
```bash
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á—É
curl -X POST -H "Authorization: Bearer <VALID_JWT>" \
  http://92.113.146.148:8000/api/v1/invite/execution/1/execute

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —É—Å–ø–µ—Ö –µ—Å–ª–∏ –µ—Å—Ç—å –∞—É–¥–∏—Ç–æ—Ä–∏—è
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –±–µ–∑ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏" –µ—Å–ª–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –Ω–µ—Ç
```

### –¢–µ—Å—Ç 7: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
curl -H "Authorization: Bearer <VALID_JWT>" \
  http://92.113.146.148:8000/api/v1/invite/execution/1/status

# –ü–æ–ª—É—á–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
curl -H "Authorization: Bearer <VALID_JWT>" \
  http://92.113.146.148:8000/api/v1/invite/execution/1/diagnose

# –ò—Å–ø—Ä–∞–≤—å—Ç–µ —Å—á–µ—Ç—á–∏–∫ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
curl -X POST -H "Authorization: Bearer <VALID_JWT>" \
  http://92.113.146.148:8000/api/v1/invite/execution/1/fix-count
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -i C:\Users\nikit\.ssh\server_key admin@telegraminvi.vps.webdock.cloud

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ invite-service
docker-compose logs invite-service | tail -50

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f invite-service
```

### –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:

1. **JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**:
   ```
   ‚úÖ Invite Service: JWT —Å–µ–∫—Ä–µ—Ç –ø–æ–ª—É—á–µ–Ω –∏–∑ Vault
   üîê JWT Authorization successful for user_id=X
   ```

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Parsing Service**:
   ```
   –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è X
   –ü–æ–ª—É—á–µ–Ω–æ Y –∑–∞–¥–∞—á –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è X
   ```

3. **–ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤**:
   ```
   –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ X —Ü–µ–ª–µ–π –¥–ª—è –∑–∞–¥–∞—á–∏ Y –∏–∑ —Ñ–∞–π–ª–∞ Z. –û–±—â–∏–π —Å—á–µ—Ç—á–∏–∫: N
   ```

4. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á**:
   ```
   –ó–∞–¥–∞—á–∞ X: –Ω–∞–π–¥–µ–Ω–æ Y —Ü–µ–ª–µ–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   ```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

### –ü—Ä–æ–±–ª–µ–º–∞: "No parsing results found"
**–†–µ—à–µ–Ω–∏–µ**: 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ parsing-service –∑–∞–ø—É—â–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ JWT —Ç–æ–∫–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –±–µ–∑ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏"
**–†–µ—à–µ–Ω–∏–µ**:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `/execution/{task_id}/diagnose`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–µ–ª–µ–π: `/tasks/{task_id}`
3. –ò—Å–ø—Ä–∞–≤—å—Ç–µ —Å—á–µ—Ç—á–∏–∫: `/execution/{task_id}/fix-count`
4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
**–†–µ—à–µ–Ω–∏–µ**:
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/execution/{task_id}/fix-count`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ target_count –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Parsing Service —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å fallback)
- ‚úÖ –ò–º–ø–æ—Ä—Ç –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°—á–µ—Ç—á–∏–∫–∏ —Ü–µ–ª–µ–π –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! 