# INVITE SERVICE - –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò

> **–≠—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ Invite Service –≤ —Ä–∞–º–∫–∞—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π SaaS-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã content-factory. –î–æ–∫—É–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ—Ç–∞–ª–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞ –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ –∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã.**

## –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê

### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è SaaS-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **Docker Compose** –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –µ–¥–∏–Ω–æ–π backend —Å–µ—Ç—å—é
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫**: Python (FastAPI), PostgreSQL, MySQL, Redis, RabbitMQ, Vault, Nginx, ELK, Prometheus/Grafana
- **–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç**:
  - **Integration Service** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ (Telegram —Å QR/SMS/2FA)
  - **Parsing Service** - —Å–±–æ—Ä –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏–∑ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ (–º—É–ª—å—Ç–∏–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π)
  - **API Gateway** - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
  - **User Service** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Vault —Å AppRole Authentication, HTTPS, –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ user_id

### –ú–µ—Å—Ç–æ Invite Service –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
Invite Service —è–≤–ª—è–µ—Ç—Å—è **—Ç—Ä–µ—Ç—å–∏–º –∫–ª—é—á–µ–≤—ã–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–º** –≤–æ—Ä–æ–Ω–∫–∏:
1. **Integration Service** ‚Üí –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤
2. **Parsing Service** ‚Üí —Å–±–æ—Ä —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ 
3. **Invite Service** ‚Üí –º–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å)

## –¶–ï–õ–ò –ò –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï

### –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π** –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø—ã/–∫–∞–Ω–∞–ª—ã –∏ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **–°–æ–±–ª—é–¥–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º** - —Å—Ç—Ä–æ–≥–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∞–Ω—Ç–∏—Å–ø–∞–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º
- **–ú—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–Ω–æ—Å—Ç—å** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç—å—é –ø—Ä–∏ —Ñ–ª—É–¥-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Instagram/WhatsApp

## –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ò –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Integration    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   Invite         ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   Parsing       ‚îÇ
‚îÇ  Service        ‚îÇ    ‚îÇ   Service        ‚îÇ    ‚îÇ   Service       ‚îÇ
‚îÇ  (–∞–∫–∫–∞—É–Ω—Ç—ã)     ‚îÇ    ‚îÇ   (—Ä–∞—Å—Å—ã–ª–∫–∏)     ‚îÇ    ‚îÇ   (–∞—É–¥–∏—Ç–æ—Ä–∏—è)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   API Gateway    ‚îÇ
                    ‚îÇ  (JWT Auth)      ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Backend**: Python 3.11+, FastAPI (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL 15 (–æ—Ç–¥–µ–ª—å–Ω–∞—è –ë–î invite_service)
- **–û—á–µ—Ä–µ–¥–∏**: Celery + RabbitMQ (–¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis (—Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á, –∞–∫–∫–∞—É–Ω—Ç–æ–≤)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Vault AppRole Authentication
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Prometheus –º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ELK
- **Platform API Libraries**: 
  - Telegram: Telethon/Pyrogram
  - Instagram: instagram-private-api (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)
  - WhatsApp: whatsapp-web.js –∏–ª–∏ Cloud API (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
backend/invite-service/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/endpoints/           # REST API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ core/                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ models/                    # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas/                   # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/                  # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ adapters/                  # Platform adapters (Strategy pattern)
‚îÇ   ‚îú‚îÄ‚îÄ workers/                   # Celery –≤–æ—Ä–∫–µ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ utils/                     # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ migrations/                    # Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ main.py
```

## –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

#### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ —Ä–∞—Å—Å—ã–ª–æ–∫
- **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á** —á–µ—Ä–µ–∑ REST API —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
  - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ (telegram, instagram, whatsapp)
  - –ò—Å—Ç–æ—á–Ω–∏–∫ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (parsing-service ID –∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª)
  - –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è (–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª, –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
  - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö {username}, {first_name}
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–¥–∞—á–∏ (HIGH, NORMAL, LOW)
  - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏–ª–∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫)

#### 2. –ò–º–ø–æ—Ä—Ç —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏
**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö:**
- **Parsing Service API**: `GET /api/parsing/results/{task_id}/users`
- **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤**: CSV, XLSX, JSON —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Å—Ç–æ–ª–±—Ü–æ–≤
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ username, phone, user_id

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤:**
- Telegram: @username, user_id, +phone
- Instagram: username, user_id (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)
- WhatsApp: +phone –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)

#### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Integration Service:**
- `GET /api/integrations/accounts?platform=telegram&user_id={user_id}`
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ç–∞—Ç—É—Å–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ Redis

#### 4. Platform Adapters (Strategy Pattern)
**–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```python
class InviteStrategy(ABC):
    @abstractmethod
    async def initialize_client(self, account_data: dict) -> bool
    
    @abstractmethod
    async def invite_to_group(self, target_user: str, group_id: str) -> InviteResult
    
    @abstractmethod
    async def send_message(self, target_user: str, message: str) -> MessageResult
    
    @abstractmethod
    async def add_to_contacts(self, target_user: str) -> bool
    
    @abstractmethod
    def get_rate_limits(self) -> RateLimitConfig
```

**TelegramStrategy (–ø–µ—Ä–≤–æ–æ—á–µ—Ä–µ–¥–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è):**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TelegramClient —á–µ—Ä–µ–∑ Telethon
- –û–±—Ä–∞–±–æ—Ç–∫–∞ session –¥–∞–Ω–Ω—ã—Ö –∏–∑ Vault
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ —Ü–µ–ª–µ–≤—ã—Ö –≥—Ä—É–ø–ø–∞—Ö/–∫–∞–Ω–∞–ª–∞—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- Graceful –æ–±—Ä–∞–±–æ—Ç–∫–∞ FloodWait, PrivacyRestriction, PeerFlood

### –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –ª–∏–º–∏—Ç–∞–º–∏

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞:**
```python
def calculate_optimal_speed(
    platform: Platform,
    accounts_count: int,
    target_users_count: int,
    message_has_links: bool
) -> RateConfig:
    # Telegram –ª–∏–º–∏—Ç—ã
    if platform == Platform.TELEGRAM:
        daily_limit_per_account = 10 if message_has_links else 40
        pause_between_actions = 15  # —Å–µ–∫—É–Ω–¥
        
        total_daily_capacity = accounts_count * daily_limit_per_account
        estimated_hours = max(1, target_users_count / total_daily_capacity * 24)
        
        return RateConfig(
            messages_per_hour=total_daily_capacity // 24,
            pause_between_messages=pause_between_actions,
            accounts_rotation=True
        )
```

#### –°–∏—Å—Ç–µ–º–∞ –∞–Ω—Ç–∏—Ñ–ª—É–¥ –∑–∞—â–∏—Ç—ã
**FloodWait –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ FloodWaitError
- –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–∞ cooldown —Å–æ–≥–ª–∞—Å–Ω–æ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è
- –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ cooldown

**–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–∞—Å—Ç–æ—Ç—ã FloodWait —Å–æ–±—ã—Ç–∏–π
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–∞—É–∑ –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏
- –°–Ω–∏–∂–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤

#### –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á
**Celery –æ—á–µ—Ä–µ–¥–∏:**
- `invite-high-priority` - —Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
- `invite-normal` - –æ–±—ã—á–Ω—ã–µ –∑–∞–¥–∞—á–∏  
- `invite-low` - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

**–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:**
- High priority –∑–∞–¥–∞—á–∏ –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª—å—à–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- Round-robin –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- –ü—Ä–µemption: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏

## –ë–ê–ó–ê –î–ê–ù–ù–´–• –ò –ú–û–î–ï–õ–ò

### –°—Ö–µ–º–∞ PostgreSQL
```sql
-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–¥–∞—á
CREATE TABLE invite_tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    platform VARCHAR(20) NOT NULL,
    task_type VARCHAR(20) NOT NULL, -- 'invite_to_group', 'send_messages'
    title VARCHAR(255) NOT NULL,
    description TEXT,
    target_group_id VARCHAR(255), -- –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø—É
    message_template TEXT,
    priority INTEGER DEFAULT 2, -- 1=HIGH, 2=NORMAL, 3=LOW
    status VARCHAR(20) DEFAULT 'pending',
    progress JSONB DEFAULT '{}',
    settings JSONB DEFAULT '{}',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    scheduled_at TIMESTAMP WITH TIME ZONE,
    started_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE
);

-- –¶–µ–ª–µ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏
CREATE TABLE invite_targets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID REFERENCES invite_tasks(id) ON DELETE CASCADE,
    user_identifier VARCHAR(255) NOT NULL,
    user_data JSONB DEFAULT '{}', -- {username, first_name, phone, etc}
    status VARCHAR(20) DEFAULT 'pending',
    result JSONB DEFAULT '{}',
    processed_at TIMESTAMP WITH TIME ZONE,
    error_message TEXT
);

-- –ê–∫–∫–∞—É–Ω—Ç—ã –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–µ –≤ –∑–∞–¥–∞—á–µ
CREATE TABLE invite_task_accounts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID REFERENCES invite_tasks(id) ON DELETE CASCADE,
    account_id VARCHAR(255) NOT NULL,
    platform VARCHAR(20) NOT NULL,
    status VARCHAR(20) DEFAULT 'active', -- active, cooldown, blocked
    cooldown_until TIMESTAMP WITH TIME ZONE,
    stats JSONB DEFAULT '{}',
    last_used_at TIMESTAMP WITH TIME ZONE
);

-- –õ–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
CREATE TABLE invite_execution_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID REFERENCES invite_tasks(id) ON DELETE CASCADE,
    target_id UUID REFERENCES invite_targets(id) ON DELETE CASCADE,
    account_id VARCHAR(255) NOT NULL,
    action VARCHAR(50) NOT NULL,
    status VARCHAR(20) NOT NULL,
    details JSONB DEFAULT '{}',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_invite_tasks_user_status ON invite_tasks(user_id, status);
CREATE INDEX idx_invite_targets_task_status ON invite_targets(task_id, status);
CREATE INDEX idx_invite_logs_task_created ON invite_execution_logs(task_id, created_at);
```

### SQLAlchemy –º–æ–¥–µ–ª–∏
**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏:**
- `InviteTask` - –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –∑–∞–¥–∞—á–∏
- `InviteTarget` - —Ü–µ–ª–µ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `InviteTaskAccount` - –∞–∫–∫–∞—É–Ω—Ç—ã –≤ –∑–∞–¥–∞—á–µ
- `InviteExecutionLog` - –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**Pydantic —Å—Ö–µ–º—ã:**
- `InviteTaskCreate`, `InviteTaskResponse`
- `TargetUserImport`, `TaskStatusResponse`
- `TaskStatistics`, `AccountStatus`

## API ENDPOINTS

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints
```python
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏
POST   /api/v1/invite/tasks                    # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
GET    /api/v1/invite/tasks                    # –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /api/v1/invite/tasks/{task_id}          # –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏
PUT    /api/v1/invite/tasks/{task_id}          # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
DELETE /api/v1/invite/tasks/{task_id}          # –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
POST   /api/v1/invite/tasks/{task_id}/start    # –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏
POST   /api/v1/invite/tasks/{task_id}/pause    # –ü–∞—É–∑–∞
POST   /api/v1/invite/tasks/{task_id}/resume   # –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
POST   /api/v1/invite/tasks/{task_id}/cancel   # –û—Ç–º–µ–Ω–∞

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã
GET    /api/v1/invite/tasks/{task_id}/status   # –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
GET    /api/v1/invite/tasks/{task_id}/stats    # –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET    /api/v1/invite/tasks/{task_id}/report   # –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
GET    /api/v1/invite/tasks/{task_id}/logs     # –õ–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

# –ò–º–ø–æ—Ä—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏
POST   /api/v1/invite/import/file              # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
POST   /api/v1/invite/import/parsing           # –ò–∑ parsing-service
GET    /api/v1/invite/import/validate          # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

# –°–ª—É–∂–µ–±–Ω—ã–µ endpoints
GET    /api/v1/invite/health                   # Health check
GET    /api/v1/invite/accounts                 # –î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
```

## CELERY –í–û–†–ö–ï–†–´ –ò –§–û–ù–û–í–´–ï –ó–ê–î–ê–ß–ò

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤
```python
# –û—Å–Ω–æ–≤–Ω—ã–µ Celery –∑–∞–¥–∞—á–∏
@celery_app.task(bind=True)
def execute_invite_task(self, task_id: str):
    """–ì–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∫–∏"""
    
@celery_app.task
def process_target_batch(task_id: str, target_ids: List[str], account_id: str):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º"""
    
@celery_app.task
def reactivate_account_after_cooldown(account_id: str, task_id: str):
    """–í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ—Å–ª–µ FloodWait"""
    
@celery_app.task
def cleanup_completed_tasks():
    """–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á"""
```

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
**–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –ø–æ –∞–∫–∫–∞—É–Ω—Ç–∞–º:**
- –ö–∞–∂–¥—ã–π –∞–∫–∫–∞—É–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π –±–∞—Ç—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ Celery –ø–æ–¥–∑–∞–¥–∞—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —á–µ—Ä–µ–∑ Redis –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
- Permanent fail –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- Circuit breaker –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ API

## –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### Vault Integration
**AppRole Authentication:**
```python
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
VAULT_ADDR=http://vault:8201
VAULT_ROLE_ID=${INVITE_SERVICE_ROLE_ID}
VAULT_SECRET_ID=${INVITE_SERVICE_SECRET_ID}

# –°–µ–∫—Ä–µ—Ç—ã –≤ Vault
secret/invite-service/jwt_secret
secret/telegram/api_credentials
```

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∏–∑–æ–ª—è—Ü–∏—è
- **JWT —Ç–æ–∫–µ–Ω—ã** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ –æ–±—â–∏–π secret –∏–∑ Vault
- **User isolation** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ user_id –∏–∑ —Ç–æ–∫–µ–Ω–∞
- **Account access** - –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –∞–∫–∫–∞—É–Ω—Ç–∞–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Audit logging** - –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

### Integration Service API
**–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤:**
```python
async def get_user_accounts(user_id: str, platform: str) -> List[AccountData]:
    response = await http_client.get(
        f"{INTEGRATION_SERVICE_URL}/api/v1/accounts",
        params={"user_id": user_id, "platform": platform, "status": "active"}
    )
    return response.json()
```

## –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ú–ï–¢–†–ò–ö–ò

### Prometheus –º–µ—Ç—Ä–∏–∫–∏
```python
# –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
invite_tasks_total = Counter('invite_tasks_total', ['platform', 'status'])
invite_targets_processed = Counter('invite_targets_processed', ['platform', 'result'])
invite_accounts_blocked = Counter('invite_accounts_blocked', ['platform'])
invite_floodwait_events = Counter('invite_floodwait_events', ['platform'])
invite_task_duration = Histogram('invite_task_duration_seconds', ['platform'])
invite_active_tasks = Gauge('invite_active_tasks', ['platform'])
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏:**
```python
logger.info(
    "Task started",
    extra={
        "task_id": task_id,
        "user_id": user_id,
        "platform": platform,
        "targets_count": len(targets),
        "accounts_count": len(accounts)
    }
)
```

### Alerting –ø—Ä–∞–≤–∏–ª–∞
- –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- –î–ª–∏—Ç–µ–ª—å–Ω–æ –≤–∏—Å—è—â–∏–µ –∑–∞–¥–∞—á–∏
- –û—à–∏–±–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –æ—á–µ—Ä–µ–¥–∏ Celery

## –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï

### Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```yaml
# docker-compose.yml –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
invite-service:
  build: ./backend/invite-service
  environment:
    - DATABASE_URL=postgresql://invite_user:invite_password@invite-postgres:5432/invite_db
    - REDIS_URL=redis://redis:6379/3
    - CELERY_BROKER_URL=amqp://user:password@rabbitmq:5672//
    - VAULT_ADDR=http://vault:8201
    - VAULT_ROLE_ID=${INVITE_SERVICE_ROLE_ID}
    - VAULT_SECRET_ID=${INVITE_SERVICE_SECRET_ID}
  ports:
    - "127.0.0.1:8003:8000"
  networks:
    - backend
```

### –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- **Unit —Ç–µ—Å—Ç—ã** - Platform adapters, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- **Integration —Ç–µ—Å—Ç—ã** - API endpoints, database –æ–ø–µ—Ä–∞—Ü–∏–∏  
- **E2E —Ç–µ—Å—Ç—ã** - –ø–æ–ª–Ω—ã–π workflow —Å mock Telegram API
- **Load —Ç–µ—Å—Ç—ã** - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–∫–∞—Ö

### –ü–æ—ç—Ç–∞–ø–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
1. **–§–∞–∑–∞ 1**: –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, Telegram adapter
2. **–§–∞–∑–∞ 2**: –ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
3. **–§–∞–∑–∞ 3**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. **–§–∞–∑–∞ 4**: Instagram/WhatsApp adapters (–±—É–¥—É—â–µ–µ)

## –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **Connection pooling** –¥–ª—è PostgreSQL –∏ Redis
- **–ë–∞—Ç—á–∏–Ω–≥** –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –ë–î (bulk insert/update)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å—Ç–∞—Ç—É—Å–æ–≤ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∏ –∑–∞–¥–∞—á –≤ Redis
- **Async I/O** –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö API –≤—ã–∑–æ–≤–æ–≤

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Multiple Celery workers** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
- **Database sharding** –ø–æ user_id –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏
- **Redis cluster** –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **Load balancer** –¥–ª—è FastAPI –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤

### –õ–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ú–∞–∫—Å–∏–º—É–º 1000 —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∑–∞–¥–∞—á—É (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ)
- –ú–∞–∫—Å–∏–º—É–º 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –†–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–æ 10MB
- Retention –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è –ª–æ–≥–æ–≤ - 30 –¥–Ω–µ–π

---

**–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –∑–∞–¥–∞–Ω–∏–µ–º –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Invite Service –≤ —Ä–∞–º–∫–∞—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã content-factory –ø—Ä–æ–µ–∫—Ç–∞. –ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–Ω—ã–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.**

---

## –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ò –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### 2025-08-22: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

#### **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è PostgreSQL enum —Ç–∏–ø–æ–≤**
–í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±—ã–ª–∏ –≤–Ω–µ—Å–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```sql
-- –°–æ–∑–¥–∞–Ω–Ω—ã–µ enum —Ç–∏–ø—ã –≤ PostgreSQL
CREATE TYPE taskstatus AS ENUM ('PENDING', 'IN_PROGRESS', 'COMPLETED', 'FAILED', 'CANCELLED', 'PAUSED');
CREATE TYPE taskpriority AS ENUM ('LOW', 'MEDIUM', 'HIGH');
CREATE TYPE targetsource AS ENUM ('MANUAL', 'FILE_UPLOAD', 'PARSING_IMPORT');
CREATE TYPE executionstatus AS ENUM ('PENDING', 'SUCCESS', 'FAILED', 'SKIPPED');

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å enum —Ç–∏–ø–∞–º–∏
ALTER TABLE invite_tasks ALTER COLUMN status TYPE taskstatus USING status::taskstatus;
ALTER TABLE invite_tasks ALTER COLUMN priority TYPE taskpriority USING priority::taskpriority;
ALTER TABLE invite_targets ALTER COLUMN source TYPE targetsource USING source::targetsource;
ALTER TABLE invite_execution_logs ALTER COLUMN status TYPE executionstatus USING status::executionstatus;
```

#### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
```sql
-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ invite_tasks
CREATE TABLE invite_tasks (
    id SERIAL PRIMARY KEY,  -- –ò–∑–º–µ–Ω–µ–Ω–æ —Å UUID –Ω–∞ SERIAL –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
    user_id INTEGER NOT NULL,
    name VARCHAR(255) NOT NULL,
    platform VARCHAR(50) NOT NULL,
    status taskstatus DEFAULT 'PENDING',
    priority taskpriority DEFAULT 'MEDIUM',
    settings JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ invite_targets
CREATE TABLE invite_targets (
    id SERIAL PRIMARY KEY,
    task_id INTEGER REFERENCES invite_tasks(id) ON DELETE CASCADE,
    username VARCHAR(255),
    phone_number VARCHAR(20),
    user_id_platform VARCHAR(255),
    email VARCHAR(255),
    full_name VARCHAR(255),
    source targetsource DEFAULT 'MANUAL',
    status VARCHAR(20) DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ invite_execution_logs
CREATE TABLE invite_execution_logs (
    id SERIAL PRIMARY KEY,
    task_id INTEGER REFERENCES invite_tasks(id) ON DELETE CASCADE,
    target_id INTEGER REFERENCES invite_targets(id) ON DELETE CASCADE,
    account_id VARCHAR(255) NOT NULL,
    action VARCHAR(100) NOT NULL,
    status executionstatus NOT NULL,
    details JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è SQLAlchemy –º–æ–¥–µ–ª–µ–π**
```python
# backend/invite-service/app/models/invite_task.py
from sqlalchemy import Column, Integer, String, DateTime, Enum as SQLEnum, JSON
from sqlalchemy.ext.declarative import declarative_base
from enum import Enum
from datetime import datetime

Base = declarative_base()

class TaskStatus(str, Enum):
    PENDING = "PENDING"
    IN_PROGRESS = "IN_PROGRESS"
    COMPLETED = "COMPLETED"
    FAILED = "FAILED"
    CANCELLED = "CANCELLED"
    PAUSED = "PAUSED"

class TaskPriority(str, Enum):
    LOW = "LOW"
    MEDIUM = "MEDIUM"
    HIGH = "HIGH"

class InviteTask(Base):
    __tablename__ = "invite_tasks"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, nullable=False)
    name = Column(String(255), nullable=False)
    platform = Column(String(50), nullable=False)
    status = Column(SQLEnum(TaskStatus, name="taskstatus"), default=TaskStatus.PENDING)
    priority = Column(SQLEnum(TaskPriority, name="taskpriority"), default=TaskPriority.MEDIUM)
    settings = Column(JSON, default={})
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
```

#### **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Pydantic —Å—Ö–µ–º —Å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏**
```python
# backend/invite-service/app/schemas/invite_task.py
from pydantic import BaseModel, validator
from typing import Optional
from datetime import datetime

class InviteTaskCreate(BaseModel):
    name: str
    platform: str
    status: TaskStatus = TaskStatus.PENDING
    priority: TaskPriority = TaskPriority.MEDIUM
    settings: Optional[dict] = {}
    
    @validator('status', pre=True)
    def validate_status(cls, v):
        if isinstance(v, str):
            return TaskStatus(v.upper())
        return v
    
    @validator('priority', pre=True)
    def validate_priority(cls, v):
        if isinstance(v, str):
            return TaskPriority(v.upper())
        return v

class InviteTaskResponse(BaseModel):
    id: int
    user_id: int
    name: str
    platform: str
    status: TaskStatus
    priority: TaskPriority
    settings: dict
    created_at: datetime
    updated_at: datetime
    
    class Config:
        orm_mode = True
```

#### **–ú–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Integration Service**

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö account_id:**
```python
# –í—Å–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ UUID —Ñ–æ—Ä–º–∞—Ç—É
# backend/integration-service/app/schemas/telegram_invites.py
from uuid import UUID

class TelegramAccountLimitsResponse(BaseModel):
    account_id: UUID  # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å int –Ω–∞ UUID
    limits: Dict[str, int]
    current_usage: Dict[str, int]
    restrictions: List[str]
    last_updated: datetime
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
```python
# backend/invite-service/app/services/integration_client.py
async def _get_jwt_token(self) -> str:
    """JWT —Ç–æ–∫–µ–Ω –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"""
    payload = {
        'sub': 'nikita.f3d@gmail.com',  # –ü–æ–ª–µ sub —Å email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        'service': 'invite-service',
        'iat': datetime.utcnow(),
        'exp': datetime.utcnow() + timedelta(hours=1)
    }
    return jwt.encode(payload, secret_data['secret_key'], algorithm='HS256')
```

#### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ API endpoints Integration Service**
```python
# backend/integration-service/app/api/v1/endpoints/telegram_invites.py
@router.get("/accounts/{account_id}/limits", response_model=TelegramAccountLimitsResponse)
async def get_account_limits(account_id: UUID, request: Request):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ Telegram –∞–∫–∫–∞—É–Ω—Ç–∞"""
    user_id = await get_user_id_from_request(request)
    account = await telegram_service.session_service.get_user_session_by_id(session, user_id, account_id)
    
    if not account:
        raise HTTPException(status_code=404, detail="Telegram –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    limits = {
        "daily_invites": 50,
        "daily_messages": 40,
        "hourly_invites": 5,
        "flood_wait_buffer": 300
    }
    
    current_usage = {
        "daily_invites_used": 0,
        "daily_messages_used": 0,
        "hourly_invites_used": 0
    }
    
    return TelegramAccountLimitsResponse(
        account_id=account_id,
        limits=limits,
        current_usage=current_usage,
        restrictions=[],
        last_updated=datetime.utcnow()
    )
```

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### **‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ enum —Ç–∏–ø–∞–º–∏
- **API —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á**: POST /api/v1/tasks/ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- **–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å parsing-service –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏
- **JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ú–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É invite-service –∏ integration-service
- **–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤**: API –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–≤

#### **üîß –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:**
- **Endpoint limits**: –û—à–∏–±–∫–∞ 500 –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ª–∏–º–∏—Ç–æ–≤ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- **Worker –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è limits endpoint

#### **üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- **Production-ready Database**: –í—Å–µ enum —Ç–∏–ø—ã, –∏–Ω–¥–µ–∫—Å—ã –∏ constraints –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- **Type Safety**: –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è —Å Pydantic –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏
- **Inter-service Communication**: –ù–∞–¥–µ–∂–Ω–∞—è HTTP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- **Error Handling**: Comprehensive –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å retry –ª–æ–≥–∏–∫–æ–π
- **Data Consistency**: –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –≤—Å–µ–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

**Invite Service –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞–¥–∏–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç, –æ—Å—Ç–∞–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –ª–∏–º–∏—Ç–æ–≤ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–ª–Ω–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.** 