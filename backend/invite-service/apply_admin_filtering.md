# Применение фиксов для админской фильтрации аккаунтов

## Проблема
Воркер определял все активные аккаунты как "админские" и пропускал их для инвайтов, но реально только 1 из 3 аккаунтов является администратором с правами приглашать пользователей.

## Исправления

### 1. Добавлена реальная проверка админских прав в воркере
- Заменена заглушка в `_filter_admin_accounts()` на реальные API запросы к integration-service
- Добавлена функция `_check_account_admin_rights()` для проверки через HTTP API
- Добавлен fallback `_filter_accounts_basic()` для случаев без group_id

### 2. Добавлен API эндпоинт в integration-service  
- Создан `/api/v1/telegram/accounts/{account_id}/check-admin` эндпоинт
- Проверяет реальные админские права через Telegram API
- Возвращает is_admin, permissions, has_required_permissions

## Команды для применения

```bash
# Скопировать обновленный воркер
cp workers/invite_worker.py workers/invite_worker.py.backup
# (файл уже обновлен)

# Скопировать обновленный integration-service эндпоинт
cp ../integration-service/app/api/v1/endpoints/telegram_invites.py ../integration-service/app/api/v1/endpoints/telegram_invites.py.backup  
# (файл уже обновлен)

# Перезапустить сервисы
docker-compose restart invite-worker integration-service

# Проверить логи
docker-compose logs invite-worker --tail 50
docker-compose logs integration-service --tail 50
```

## Изменения в логах

**Старые логи:**
```
Аккаунт XXX прошел базовые проверки (активен, лимиты OK)
Фильтрация аккаунтов: из 3 доступно 3 админских аккаунтов
```

**Новые логи:**
```
Проверяем админские права для группы foothub123 для 3 аккаунтов
✅ Аккаунт XXX является администратором группы foothub123 с правами приглашать
❌ Аккаунт YYY НЕ является администратором группы foothub123 или не имеет прав приглашать  
❌ Аккаунт ZZZ НЕ является администратором группы foothub123 или не имеет прав приглашать
Фильтрация аккаунтов: из 3 доступно 1 админских аккаунтов
```

## Важные особенности

1. **group_id обязателен**: Берется из `task.settings.group_id`
2. **Fallback на базовую фильтрацию**: Если нет group_id, используется старая логика  
3. **Обработка ошибок**: При ошибках API не добавляет аккаунт в админские
4. **Детальное логирование**: Показывает причины отклонения каждого аккаунта

## Результат
Теперь воркер будет выбирать только те аккаунты, которые реально являются администраторами с правами `invite_users` в целевой группе/канале.