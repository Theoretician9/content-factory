# CHECK LIST: Подготовка инфраструктуры до и после проектирования микросервисов

---

## 1. Что нужно сделать сейчас (до появления архитектуры микросервисов)

### 1.1. Базовая инфраструктура
- [x] Настроить и протестировать Docker Compose, сети, volume, базовые сервисы (MySQL, Redis, RabbitMQ, Vault, Prometheus, Grafana, ELK)
  - [x] Все сервисы стартуют и доступны по нужным адресам
  - [x] Все volumes и сети корректно проброшены
  - [x] Нет лишних открытых портов наружу
- [x] Централизованное логирование (Logstash → Elasticsearch → Kibana)
  - [x] Logstash видит и обрабатывает тестовые логи
  - [x] В Elasticsearch появляются индексы logs-*
  - [x] Kibana подключена к Elasticsearch
  - [ ] Kibana не может создать служебный индекс .kibana_7.17.0 (ошибка index_not_found_exception). Требуется убедиться, что Elasticsearch полностью готов до старта Kibana, и проверить права на создание индексов. Проблема не блокирует работу ELK, но мешает пользоваться интерфейсом Kibana.
- [x] Мониторинг инфраструктуры (Prometheus, Grafana)
  - [x] Проверить, что метрики собираются и отображаются в Grafana
- [x] Vault (секреты и управление доступом)
  - [x] Vault стартует в dev-режиме, успешно инициализируется и unseal
  - [ ] Внимание: dev-режим не подходит для продакшена! Для тестов и разработки — ок. В будущем перевести Vault в production-режим с безопасным хранением ключей.
- [ ] Настроить firewall для инфраструктурных сервисов
  - [ ] Разрешены только нужные порты
  - [ ] Админ-панели доступны только из доверенных сетей
- [ ] Настроить HTTPS для публичных сервисов (API Gateway, Grafana и т.д.)
  - [ ] Сертификаты установлены
  - [ ] Работает автоматическое обновление сертификатов (если нужно)
- [ ] Настроить хранение секретов (Vault)
  - [ ] Vault доступен только из backend-сети
  - [ ] Секреты можно безопасно получать из Vault
- [ ] Проверить автоматический деплой (CI/CD)
  - [ ] Изменения из репозитория попадают на сервер
  - [ ] Деплой не требует ручных действий
- [ ] Документировать инфраструктуру
  - [ ] Описаны все доступы, пароли, токены, адреса сервисов (в защищённом месте)
  - [ ] Описана структура docker-compose, связи между сервисами, порты, volume
  - [ ] Описан процесс деплоя, обновления, восстановления
  - [ ] Описан процесс добавления нового сервиса
- [ ] Smoke-тесты инфраструктуры
  - [ ] Проверить, что все сервисы стартуют с нуля (docker-compose up)
  - [ ] Проверить, что все сервисы корректно завершают работу (docker-compose down)
  - [ ] Проверить, что все переменные окружения заданы и не содержат секретов в открытом виде
  - [ ] Проверить, что все контейнеры используют только необходимые volume и сети
- [x] Vault запущен в dev-режиме, root token получен, сервис доступен на 8201
- [x] Проверена доступность Vault через curl
- [x] Все сервисы могут обращаться к Vault по адресу http://vault:8201 с токеном root
- [ ] ⚠️ Перед продакшеном: перейти на prod-режим Vault (файловый backend, инициализация, unseal-ключи, отказоустойчивость)
- [ ] Настроить алерты в Alertmanager
- [ ] Создать пользовательские дашборды в Grafana

---

## 2. Что делать после появления архитектуры микросервисов

- Создать отдельные базы данных для каждого микросервиса
- Настроить пользователей и права доступа для каждого сервиса
- Реализовать и протестировать миграции схем
- Настроить очереди в RabbitMQ для всех сервисов, которые будут использовать асинхронные задачи
- Настроить кэширование в Redis (разделить пространства ключей для разных сервисов)
- Протестировать работу очередей и кэша
- Стандартизировать формат логов, трассировку, интеграцию с Logstash
- Настроить дашборды и алерты для бизнес-метрик микросервисов
- Реализовать smoke-тесты, интеграционные тесты, тестовые данные для сервисов
- Настроить CI/CD для микросервисов
- Описать процесс деплоя, обновления, восстановления для каждого сервиса

---

> **Этот файл — рабочий чек-лист подготовки инфраструктуры. Отмечайте выполненные пункты и дополняйте по мере развития проекта.**

> Базовая инфраструктура функционирует, мониторинг работает. Следующий шаг — настройка алертов и дашбордов. 